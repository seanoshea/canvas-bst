<!doctype>
<html>
    <head>
        <link rel="stylesheet" type="text/css" media="all" href="css/oocss/core/core.css" />
        <link rel="stylesheet" type="text/css" media="all" href="css/oocss/core/content.css" />
        <link rel="stylesheet" type="text/css" media="all" href="css/oocss/core/grid/grids.css" />
        <link rel="stylesheet" type="text/css" media="all" href="css/oocss/core/spacing/space.css" />
        <script src="js/backbone/test/vendor/jquery-1.5.js"></script>
        <script src="js/backbone/test/vendor/underscore-1.1.6.js"></script>
        <script src="js/backbone/backbone.js"></script>
        <script src="js/computer-science-in-javascript/data-structures/binary-search-tree/binary-search-tree.js"></script>
        <script>
            $(function() {
                window.AppView = Backbone.View.extend({

                    el: $('body'),

                    events: {
                      'click #preOrder': 'preOrderClicked',
                      'click #inOrder': 'inOrderClicked',
                      'click #postOrder': 'postOrderClicked',
                      "click #numbers": "numbersClicked",
                      'click #quickTree': 'quickTreeClicked',
                      'click #reset': 'resetClicked'
                    },
                    _tree: null,
                    xDistance: 20,
                    yDistance: 30,
                    canvasNode: null,
                    canvasContext: null,

                    initialize: function() {
                        this.preOrderButton = this.$('#preOrder');
                        this.inOrderButton = this.$('#inOrder');
                        this.postOrderButton = this.$('#postOrder');
                        this.traversalOutput = this.$('#traversalOutput');
                        this.traversalOptions = this.$('#traversalOptions');
                        this.numbersButton = this.$('#numbers');
                        this.quickTreeButton = this.$('#quickTree');
                        this.resetButton = this.$('#reset');
                        this.toggleTraversalOptions();
                        this.canvasNode = document.getElementById('canvas');
                        this.canvasContext = this.canvasNode.getContext('2d');
                    },

                    preOrderClicked: function() {
                        return false;
                    },

                    inOrderClicked: function() {
                        return false;
                    },

                    postOrderClicked: function() {
                        return false;
                    },

                    numbersClicked: function(evt) {
                        this.resetClicked(evt);
                        this._drawTree(document.getElementById('userEnteredNumbers').value.split(','));
                        this.toggleTraversalOptions(true);
                        return false;
                    },

                    quickTreeClicked: function(evt) {
                        this.resetClicked(evt);
                        this._drawTree([1, 7, 3, 99, 8, 55, 44, 33, 22, 11, 16, 84, 91, 2]);
                        this.toggleTraversalOptions(true);
                        return false;
                    },

                    resetClicked: function(evt) {
                        evt.preventDefault();
                        this.canvasContext.clearRect(0, 0, this.canvasNode.width, this.canvasNode.height);
                        var w = canvas.width;
                        canvas.width = 1;
                        canvas.width = w;
                        this.toggleTraversalOptions();
                        return false;
                    },

                    toggleTraversalOptions: function(enable) {
                        if (enable) {
                            this.traversalOptions.removeClass('dimmed');
                        } else {
                            this.traversalOptions.addClass('dimmed');
                        }
                        $.each(["preOrder", "postOrder", "inOrder", "reset"], function() {
                            $("#" + this).attr("disabled", enable ? "" : "true");
                        });
                    },

                    _drawTree: function(arr) {
                        this._tree = new BinarySearchTree();
                        _.each(arr, function(item) {
                            this._tree.add(item);
                        }, this);
                        this._drawNode(this._tree._root, 300, 40, 0, 0);
                        if (this._tree._root.left) {
                            this._drawLeft(this._tree._root.left, 300, 40);
                        }
                        if (this._tree._root.right) {
                            this._drawRight(this._tree._root.right, 300, 40);
                        }
                    },

                    _drawNode: function(node, x, y, px, py) {
                        this._drawCircle();
                        this._drawLine(x, y, px, py);
                        this._drawLabel(node, x, y);
                    },

                    _drawLeft: function(node, px, py) {
                        var count = 0, x, y;
                        if (node.right) {
                            count = 1 + this._tree.numChildren(node.right);
                        }
                        x = px - this.xDistance - (count * this.xDistance);
                        y = py + this.yDistance;
                        this._drawNode(node, x, y, px, py);
                        if (node.left) {
                            this._drawLeft(node.left, x, y);
                        }
                        if (node.right) {
                            this._drawRight(node.right, x, y);
                        }
                    },

                    _drawRight: function(node, px, py) {
                        var count = 0, x, y;
                        if (node.left) {
                            count = 1 + this._tree.numChildren(node.left);
                        }
                        x = px + this.xDistance + (count * this.xDistance);
                        y = py + this.yDistance;
                        this._drawNode(node, x, y, px, py);
                        if (node.left) {
                            this._drawLeft(node.left, x, y);
                        }
                        if (node.right) {
                            this._drawRight(node.right, x, y);
                        }
                    },

                    _drawCircle: function() {

                    },

                    _drawLine: function(x, y, px, py) {
                        if (px == 0 && py == 0) {
                            return;
                        }
                        this.canvasContext.beginPath();
                        this.canvasContext.strokeStyle = "rgb(120,120,120)";
                        this.canvasContext.moveTo(px, py);
                        this.canvasContext.lineTo(x, y);
                        this.canvasContext.stroke();
                    },

                    _drawLabel: function(node, x, y) {
                        this.canvasContext.beginPath();
                        this.canvasContext.font = "11px sans-serif";
                        this.canvasContext.fillText(node.value, x + 7, y + 5);
                        this.canvasContext.stroke();
                    }
                });
                window.App = new AppView;
            });
        </script>
        <style>
            button {
                cursor:hand;
            }
            hr {
                border:1px solid #CCC;
            }
            .dimmed button {
                cursor:default;
            }
            input[type=text] {
                width:200px;
                padding:3px;
            }
            .dimmed {
                opacity:0.5;
            }
            .canvas {
                border:1px solid #2b2b2b;
            }
            h1, .h1 {
                color:#2b2b2b;
            }
        </style>
    </head>
    <body class="line">
        <div id="controls" class="unit size1of3 ptl">
            <form class="pll">
                <legend class="h1">Tree Generation</legend>
                <p>Enter some numbers (comma separated)</p>
                <fieldset class="mll">
                    <input id="userEnteredNumbers" type="text" value="1,5,3,31,9,8,6,16,12,90,45,30,42"/>
                    <button id="numbers" type="submit" class="pam">I'm done</button>
                </fieldset>
                <p>OR</p>
                <fieldset class="mll">
                    <button id="quickTree" type="submit" class="pam">Generate A Tree with Random Numbers</button>
                </fieldset>
                <hr />
                <fieldset class="mll">
                    <button id="reset" type="reset" class="pam">Reset the Tree</button>
                </fieldset>
            </form>
            <form id="traversalOptions" class="pll ptl">
                <legend class="h1">Traversals</legend>
                <p>Click any of these buttons to see a traversal on the BST you just generated.</p>
                <fieldset class="mll">
                    <button id="preOrder" class="pam">Pre-Order</button>
                    <button id="inOrder" class="pam">In-Order</button>
                    <button id="postOrder" class="pam">Post-Order</button>
                </fieldset>
            </form>
        </div>
        <div id="output" class="unit size2of3">
            <h1 class="ptm">Traversal Output</h1>
            <p id="traversalOutput" class="mll">Your traversal output will appear here</p>
            <canvas id="canvas" width="600px" height="600px" class="canvas mll">

            </canvas>
        </div>
    </body>
</html>